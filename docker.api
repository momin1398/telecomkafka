FROM golang:1.25-alpine

WORKDIR /app

# Module proxy for Docker
ENV GO111MODULE=on
ENV GOPROXY=https://proxy.golang.org,direct

# Copy module files first
COPY go.mod go.sum ./

# Download dependencies
RUN go mod tidy
RUN go mod download

# Copy all source code
COPY . .

# Build binary
RUN go build -o collector ./cmd/collector-api

EXPOSE 8080
CMD ["./collector"]
